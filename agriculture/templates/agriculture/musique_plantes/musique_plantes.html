{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    {% include 'agriculture/partials/pwa_meta.html' %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/musique_plantes.css' %}">
    <link rel="stylesheet" href="{% static 'css/mobile_navigation.css' %}">
    <link rel="stylesheet" href="{% static 'css/logo.css' %}">
    <link rel="stylesheet" href="{% static 'css/pwa_install.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navbar Supérieure -->
    <nav class="musique-navbar">
        <div class="navbar-container">
            <!-- Logo et Recherche -->
            <div class="navbar-left">
                {% include 'agriculture/partials/logo.html' %}
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <form method="GET" action="{% url 'musique_plantes' %}" id="search-form">
                        <input type="text" name="recherche" placeholder="Rechercher des musiques..." 
                               value="{{ recherche }}" id="search-input">
                    </form>
                </div>
            </div>
            
            <!-- Navigation Centrale -->
            <div class="navbar-center">
                <a href="{% url 'newsfeed' %}" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>Accueil</span>
                </a>
                <a href="{% url 'marketplace' %}" class="nav-link">
                    <i class="fas fa-store"></i>
                    <span>Marché</span>
                </a>
                <a href="{% url 'musique_plantes' %}" class="nav-link active">
                    <i class="fas fa-music"></i>
                    <span>Musique Plantes</span>
                </a>
                <a href="{% url 'agriculteur_dashboard' %}" class="nav-link">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            
            <!-- Profil Utilisateur -->
            <div class="navbar-right">
                <div class="user-profile">
                    <img src="https://st2.depositphotos.com/1000128/6009/i/450/depositphotos_60099901-stock-photo-default-avatar.jpg" alt="Profil" class="profile-img">
                    <span class="profile-name">{{ user.get_full_name|default:user.username }}</span>
                    <div class="profile-dropdown">
                        <a href="{% url 'agriculteur_dashboard' %}">Mon Profil</a>
                        <a href="{% url 'logout' %}">Déconnexion</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Menu mobile (partial) -->
    {% include 'agriculture/partials/mobile_navigation.html' with active_page='musique_plantes' %}

    <!-- Contenu Principal -->
    <main class="musique-main">
        <!-- En-tête de section -->
        <section class="hero-section">
            <div class="hero-content">
                <div class="hero-icon">
                    <i class="fas fa-music"></i>
                </div>
                <h1 class="hero-title">Musique pour les Plantes</h1>
                <p class="hero-subtitle">Stimulez la croissance de vos plantes avec des sons et fréquences spécialement conçus</p>
            </div>
        </section>

        <!-- Filtres par catégorie -->
        <section class="filters-section">
            <div class="filters-container">
                <div class="filters-tabs">
                    {% for cat in categories %}
                    <a href="{% url 'musique_plantes' %}?categorie={{ cat }}" 
                       class="filter-tab {% if categorie_active == cat %}active{% endif %}">
                        <i class="fas fa-{% if cat == 'Nature' %}leaf{% elif cat == 'Scientifique' %}flask{% elif cat == 'Classique' %}violin{% elif cat == 'Thérapeutique' %}heart{% else %}music{% endif %}"></i>
                        <span>{{ cat }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </section>

        <!-- Résultats -->
        <section class="results-section">
            <div class="results-header">
                <h2 class="results-title">
                    <i class="fas fa-headphones"></i>
                    {{ nombre_produits }} produit{{ nombre_produits|pluralize }} disponible{{ nombre_produits|pluralize }}
                </h2>
            </div>

            <!-- Grille des produits audio -->
            <div class="produits-grid" id="produits-grid">
                {% for produit in produits_audio %}
                <div class="produit-card" data-categorie="{{ produit.categorie }}">
                    <!-- Image de couverture -->
                    <div class="produit-cover">
                        <img src="{{ produit.image }}" alt="{{ produit.titre }}" class="cover-img">
                        <div class="cover-overlay">
                            <button class="btn-play" data-produit-id="{{ produit.id }}" data-audio-url="{{ produit.audio_url }}" data-titre="{{ produit.titre }}" data-auteur="{{ produit.auteur }}" data-cover="{{ produit.image }}">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                        {% if produit.gratuit %}
                        <span class="badge-gratuit">GRATUIT</span>
                        {% else %}
                        <span class="badge-prix">{{ produit.prix }} {{ produit.prix_unite }}</span>
                        {% endif %}
                    </div>

                    <!-- Contenu de la carte -->
                    <div class="produit-content">
                        <div class="produit-header">
                            <h3 class="produit-titre">{{ produit.titre }}</h3>
                            <div class="produit-rating">
                                <i class="fas fa-star"></i>
                                <span>{{ produit.rating }}</span>
                            </div>
                        </div>

                        <p class="produit-description">{{ produit.description }}</p>

                        <div class="produit-meta">
                            <div class="meta-item">
                                <i class="far fa-clock"></i>
                                <span>{{ produit.duree }}</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-headphones"></i>
                                <span>{{ produit.ecoutes }} écoutes</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-user"></i>
                                <span>{{ produit.auteur }}</span>
                            </div>
                        </div>

                        <div class="produit-tags">
                            {% for tag in produit.tags %}
                            <span class="tag">{{ tag }}</span>
                            {% endfor %}
                        </div>

                        <!-- Actions -->
                        <div class="produit-actions">
                            {% if produit.gratuit %}
                            <button class="btn-ecouter" data-produit-id="{{ produit.id }}" data-audio-url="{{ produit.audio_url }}" data-titre="{{ produit.titre }}" data-auteur="{{ produit.auteur }}" data-cover="{{ produit.image }}">
                                <i class="fas fa-play-circle"></i>
                                <span>Écouter</span>
                            </button>
                            <button class="btn-telecharger" data-produit-id="{{ produit.id }}" data-audio-url="{{ produit.audio_url }}" data-titre="{{ produit.titre }}">
                                <i class="fas fa-download"></i>
                                <span>Télécharger</span>
                            </button>
                            {% else %}
                            <button class="btn-acheter" data-produit-id="{{ produit.id }}" data-prix="{{ produit.prix }}">
                                <i class="fas fa-shopping-cart"></i>
                                <span>Acheter {{ produit.prix }} FCFA</span>
                            </button>
                            <button class="btn-preview" data-produit-id="{{ produit.id }}" data-audio-url="{{ produit.audio_url }}" data-titre="{{ produit.titre }}" data-auteur="{{ produit.auteur }}" data-cover="{{ produit.image }}">
                                <i class="fas fa-play"></i>
                                <span>Écouter extrait</span>
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="no-results">
                    <i class="fas fa-music"></i>
                    <h3>Aucun produit trouvé</h3>
                    <p>Essayez de modifier vos critères de recherche</p>
                </div>
                {% endfor %}
            </div>
        </section>
    </main>

    <!-- Lecteur audio global -->
    <div class="audio-player" id="audio-player">
        <div class="player-container">
            <div class="player-info">
                <img src="" alt="" class="player-cover" id="player-cover">
                <div class="player-details">
                    <h4 class="player-title" id="player-title">Sélectionnez une musique</h4>
                    <p class="player-author" id="player-author"></p>
                </div>
            </div>
            
            <div class="player-controls">
                <button class="btn-player btn-prev" id="btn-prev">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="btn-player btn-play-pause" id="btn-play-pause">
                    <i class="fas fa-play"></i>
                </button>
                <button class="btn-player btn-next" id="btn-next">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
            
            <div class="player-progress">
                <span class="time-current" id="time-current">0:00</span>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
                <span class="time-total" id="time-total">0:00</span>
            </div>
            
            <button class="btn-player-close" id="btn-player-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <audio id="audio-element" preload="metadata"></audio>
    </div>

    <!-- Scripts -->
    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/mobile_navigation.js' %}"></script>
    <script src="{% static 'js/musique_plantes.js' %}"></script>
    <script src="{% static 'js/pwa.js' %}"></script>
</body>
</html>
